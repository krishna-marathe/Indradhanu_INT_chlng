<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Landing Page - Indradhanu Analytics</title>
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
        }

        /* Header Styles - Fixed Navigation */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c5aa0;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .nav-links a:hover {
            color: #2c5aa0;
        }

        /* Hero Section - Full Viewport with Video Background */
        .hero {
            position: relative;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .hero-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -2;
        }

        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: -1;
        }

        .hero-content {
            text-align: center;
            color: white;
            max-width: 800px;
            padding: 0 2rem;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .hero p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .cta-button {
            display: inline-block;
            padding: 1rem 2rem;
            background: #2c5aa0;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .cta-button:hover {
            background: #1e3f73;
        }

        /* Main Content - Feature Blocks */
        main {
            padding: 4rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        .features-section {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            margin-bottom: 4rem;
        }

        .feature-block {
            padding: 2rem;
            background: #f8f9fa;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .feature-block:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .feature-block h2 {
            color: #2c5aa0;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .feature-block p {
            color: #666;
            line-height: 1.8;
        }

        .feature-block ul {
            color: #666;
            padding-left: 1.5rem;
        }

        .feature-block li {
            margin-bottom: 0.5rem;
        }

        /* Footer Styles */
        footer {
            background: #111;
            color: #fff;
            padding: 2rem;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .social-icons {
            display: flex;
            gap: 1rem;
        }

        .social-icons a {
            color: #fff;
            font-size: 1.2rem;
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .social-icons a:hover {
            color: #2c5aa0;
        }

        .footer-text {
            text-align: center;
        }

        .footer-links {
            display: flex;
            gap: 1rem;
        }

        .footer-links a {
            color: #ccc;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .footer-links a:hover {
            color: #fff;
        }

        /* Responsive Design - Mobile First Approach */
        @media (max-width: 768px) {
            /* Navigation - Stack vertically on mobile */
            nav {
                flex-direction: column;
                padding: 1rem;
                gap: 1rem;
            }

            .nav-links {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            /* Hero Section - Adjust text size */
            .hero h1 {
                font-size: 2.5rem;
            }

            .hero p {
                font-size: 1rem;
            }

            /* Features - Single column layout */
            .features-section {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .feature-block {
                padding: 1.5rem;
            }

            /* Footer - Stack vertically */
            .footer-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .footer-links {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            /* Extra small screens */
            .hero h1 {
                font-size: 2rem;
            }

            main {
                padding: 2rem 1rem;
            }

            .feature-block {
                padding: 1rem;
            }
        }

        /* Smooth scrolling for anchor links */
        html {
            scroll-behavior: smooth;
        }

        /* Loading animation for video */
        .hero-video {
            opacity: 0;
            animation: fadeIn 2s ease-in-out forwards;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        /* Upload Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 1rem;
            top: 1rem;
        }

        .close:hover {
            color: #000;
        }

        .upload-area {
            border: 2px dashed #2c5aa0;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            margin: 1rem 0;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: #1e3f73;
            background: #e9ecef;
        }

        .upload-area.dragover {
            border-color: #1e3f73;
            background: #e3f2fd;
        }

        .file-input {
            display: none;
        }

        .upload-button {
            background: #2c5aa0;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 1rem;
            transition: background 0.3s ease;
        }

        .upload-button:hover {
            background: #1e3f73;
        }

        .upload-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Results Section */
        .results-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
            display: none;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .results-stats {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .stat-card {
            background: white;
            padding: 0.75rem 1rem;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
            min-width: 80px;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c5aa0;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #666;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .chart-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .chart-container img {
            width: 100%;
            height: auto;
            display: block;
        }

        .chart-title {
            padding: 0.75rem;
            background: #2c5aa0;
            color: white;
            font-weight: 600;
            text-align: center;
        }

        .insights-section {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .insights-section h3 {
            color: #2c5aa0;
            margin-bottom: 1rem;
        }

        .insights-list {
            list-style: none;
            padding: 0;
        }

        .insights-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }

        .insights-list li:last-child {
            border-bottom: none;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #2c5aa0;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <!-- Header Section with Navigation -->
    <header>
        <nav>
            <!-- Logo/Brand -->
            <a href="#" class="logo">üåç Indradhanu Analytics</a>
            
            <!-- Navigation Links -->
            <ul class="nav-links">
                <li><a href="#home">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#features">Features</a></li>
                <li><a href="#" onclick="openUploadModal()">Upload Data</a></li>
                <li><a href="#" onclick="openWeatherModal()">Weather Data</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- Hero Section with Video Background -->
    <section class="hero" id="home">
        <!-- Background Video -->
        <video class="hero-video" autoplay muted loop>
            <!-- Placeholder for video sources - replace with actual video files -->
            <source src="background-video.mp4" type="video/mp4">
            <source src="background-video.webm" type="video/webm">
            <!-- Fallback for browsers that don't support video -->
            Your browser does not support the video tag.
        </video>
        
        <!-- Dark overlay for text readability -->
        <div class="hero-overlay"></div>
        
        <!-- Hero Content -->
        <div class="hero-content">
            <h1>Environmental Data Analytics</h1>
            <p>Transform your environmental data into actionable insights with our powerful analytics engine. Upload, analyze, and visualize climate data effortlessly.</p>
            <button class="cta-button" onclick="openUploadModal()">Start Analyzing</button>
        </div>
    </section>

    <!-- Main Content Area -->
    <main>
        <!-- Features Section with Two-Column Layout -->
        <section class="features-section" id="features">
            <!-- Mission Block -->
            <div class="feature-block">
                <h2>Our Mission</h2>
                <p>We're dedicated to making environmental data analysis accessible and actionable. Our platform empowers researchers, organizations, and individuals to understand climate patterns and make data-driven decisions for a sustainable future.</p>
            </div>

            <!-- Key Features Block -->
            <div class="feature-block">
                <h2>Key Features</h2>
                <ul>
                    <li>Multi-format data support (CSV, XLSX, JSON)</li>
                    <li>Automated data cleaning and preprocessing</li>
                    <li>Interactive visualizations and charts</li>
                    <li>AI-powered insights generation</li>
                    <li>Real-time analytics processing</li>
                </ul>
            </div>

            <!-- Data Processing Block -->
            <div class="feature-block">
                <h2>Advanced Analytics</h2>
                <p>Our analytics engine processes environmental data using cutting-edge algorithms to identify trends, correlations, and anomalies. Get comprehensive reports with statistical analysis, correlation matrices, and predictive insights.</p>
            </div>

            <!-- Easy Integration Block -->
            <div class="feature-block">
                <h2>Easy Integration</h2>
                <p>Simple REST API integration allows you to connect our analytics engine to your existing systems. Upload data programmatically and receive structured JSON responses with charts and insights ready for your applications.</p>
            </div>
        </section>

        <!-- About Section -->
        <section id="about">
            <div class="feature-block">
                <h2>About Indradhanu Analytics</h2>
                <p>Indradhanu Analytics is a comprehensive environmental data analysis platform designed to bridge the gap between raw climate data and actionable insights. Whether you're monitoring air quality, tracking temperature patterns, or analyzing humidity trends, our platform provides the tools you need to make informed decisions.</p>
            </div>
        </section>
    </main>

    <!-- Footer Section -->
    <footer id="contact">
        <div class="footer-content">
            <!-- Social Media Icons -->
            <div class="social-icons">
                <a href="#" aria-label="Facebook">üìò</a>
                <a href="#" aria-label="Twitter">üê¶</a>
                <a href="#" aria-label="LinkedIn">üíº</a>
                <a href="#" aria-label="GitHub">üêô</a>
            </div>

            <!-- Footer Text -->
            <div class="footer-text">
                <p>&copy; 2025 Indradhanu Analytics. All rights reserved.</p>
            </div>

            <!-- Footer Links -->
            <div class="footer-links">
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Service</a>
                <a href="#">Support</a>
            </div>
        </div>
    </footer>

    <!-- Weather Modal -->
    <div id="weatherModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeWeatherModal()">&times;</span>
            <h2>Real-Time Weather Analytics</h2>
            <p>Get live weather data and analysis for any location worldwide.</p>
            
            <div style="margin: 2rem 0;">
                <!-- Location Search -->
                <div style="margin-bottom: 1.5rem;">
                    <label for="locationSearch">Search Location:</label>
                    <div style="display: flex; gap: 0.5rem; margin-top: 0.25rem;">
                        <input type="text" id="locationSearch" placeholder="Enter city name (e.g., New York, London, Tokyo)"
                               style="flex: 1; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;"
                               oninput="searchLocations(this.value)">
                        <button class="upload-button" onclick="searchAndSelect()" style="padding: 0.5rem 1rem;">
                            üîç Search
                        </button>
                    </div>
                    <div id="locationResults" style="margin-top: 0.5rem; display: none;"></div>
                </div>

                <!-- Popular Locations -->
                <div style="margin-bottom: 1.5rem;">
                    <label>Popular Locations:</label>
                    <div id="popularLocations" style="margin-top: 0.5rem; display: flex; flex-wrap: wrap; gap: 0.5rem;">
                        <!-- Popular locations will be loaded here -->
                    </div>
                </div>

                <hr style="margin: 1rem 0; border: none; border-top: 1px solid #eee;">
                
                <!-- Coordinate Input -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    <div>
                        <label for="latitude">Latitude:</label>
                        <input type="number" id="latitude" value="52.52" step="0.01" min="-90" max="90" 
                               style="width: 100%; padding: 0.5rem; margin-top: 0.25rem; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                    <div>
                        <label for="longitude">Longitude:</label>
                        <input type="number" id="longitude" value="13.41" step="0.01" min="-180" max="180"
                               style="width: 100%; padding: 0.5rem; margin-top: 0.25rem; border: 1px solid #ddd; border-radius: 4px;">
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                    <button class="upload-button" onclick="getCurrentLocation()">
                        üìç Use Current Location
                    </button>
                    <button class="upload-button" onclick="fetchWeatherData()">
                        üå§Ô∏è Get Weather Data
                    </button>
                </div>
            </div>

            <!-- Weather Results Section -->
            <div id="weatherResultsSection" class="results-section">
                <div id="weatherLoadingState" class="loading">
                    Fetching weather data, please wait...
                </div>
                <div id="weatherResultsContent" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUploadModal()">&times;</span>
            <h2>Upload Environmental Data</h2>
            <p>Upload your CSV, XLSX, or JSON file to get instant analytics and insights.</p>
            
            <div class="upload-area" id="uploadArea">
                <p>üìÅ Drag and drop your file here or click to browse</p>
                <input type="file" id="fileInput" class="file-input" accept=".csv,.xlsx,.json">
                <button type="button" class="upload-button" onclick="document.getElementById('fileInput').click()">
                    Choose File
                </button>
            </div>
            
            <div id="selectedFile" style="margin: 1rem 0; display: none;">
                <p><strong>Selected:</strong> <span id="fileName"></span></p>
                <button id="analyzeBtn" class="upload-button" onclick="uploadAndAnalyze()">
                    üöÄ Upload & Analyze
                </button>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="results-section">
                <div id="loadingState" class="loading">
                    Analyzing your data, please wait...
                </div>
                <div id="resultsContent" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let selectedFile = null;
        const API_BASE_URL = 'http://127.0.0.1:5000';

        // Initialize page functionality
        document.addEventListener('DOMContentLoaded', function() {
            initializeNavigation();
            initializeFileUpload();
        });

        // Navigation and scroll effects
        function initializeNavigation() {
            // Smooth scrolling for navigation links
            const navLinks = document.querySelectorAll('.nav-links a[href^="#"]');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href');
                    const targetSection = document.querySelector(targetId);
                    if (targetSection) {
                        targetSection.scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // Add scroll effect to header
            window.addEventListener('scroll', function() {
                const header = document.querySelector('header');
                if (window.scrollY > 100) {
                    header.style.background = 'rgba(255, 255, 255, 0.98)';
                } else {
                    header.style.background = 'rgba(255, 255, 255, 0.95)';
                }
            });
        }

        // File upload functionality
        function initializeFileUpload() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');
            const selectedFileDiv = document.getElementById('selectedFile');
            const fileName = document.getElementById('fileName');

            // File input change event
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    handleFileSelection(file);
                }
            });

            // Drag and drop functionality
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file) {
                    handleFileSelection(file);
                }
            });

            // Click to upload
            uploadArea.addEventListener('click', function() {
                fileInput.click();
            });
        }

        // Handle file selection
        function handleFileSelection(file) {
            const allowedTypes = ['.csv', '.xlsx', '.json'];
            const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
            
            if (!allowedTypes.includes(fileExtension)) {
                alert('Please select a CSV, XLSX, or JSON file.');
                return;
            }

            selectedFile = file;
            document.getElementById('fileName').textContent = file.name;
            document.getElementById('selectedFile').style.display = 'block';
        }

        // Modal functions
        function openUploadModal() {
            document.getElementById('uploadModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeUploadModal() {
            document.getElementById('uploadModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            resetUploadForm();
        }

        function resetUploadForm() {
            selectedFile = null;
            document.getElementById('fileInput').value = '';
            document.getElementById('selectedFile').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('loadingState').style.display = 'block';
            document.getElementById('resultsContent').style.display = 'none';
        }

        // Upload and analyze function
        async function uploadAndAnalyze() {
            if (!selectedFile) {
                alert('Please select a file first.');
                return;
            }

            const resultsSection = document.getElementById('resultsSection');
            const loadingState = document.getElementById('loadingState');
            const resultsContent = document.getElementById('resultsContent');
            const analyzeBtn = document.getElementById('analyzeBtn');

            // Show loading state
            resultsSection.style.display = 'block';
            loadingState.style.display = 'block';
            resultsContent.style.display = 'none';
            analyzeBtn.disabled = true;
            analyzeBtn.textContent = 'Analyzing...';

            try {
                const formData = new FormData();
                formData.append('file', selectedFile);

                const response = await fetch(`${API_BASE_URL}/upload`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(errorText || 'Upload failed');
                }

                const data = await response.json();
                displayResults(data);

            } catch (error) {
                console.error('Upload error:', error);
                resultsContent.innerHTML = `
                    <div style="color: red; text-align: center; padding: 2rem;">
                        <h3>‚ùå Error</h3>
                        <p>${error.message}</p>
                    </div>
                `;
                resultsContent.style.display = 'block';
            } finally {
                loadingState.style.display = 'none';
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = 'üöÄ Upload & Analyze';
            }
        }

        // Display results function
        function displayResults(data) {
            const resultsContent = document.getElementById('resultsContent');
            
            let html = `
                <div class="results-header">
                    <h3>üìä Analysis Results</h3>
                    <div class="results-stats">
                        <div class="stat-card">
                            <div class="stat-value">${data.rows || 0}</div>
                            <div class="stat-label">Rows</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${data.columns || 0}</div>
                            <div class="stat-label">Columns</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${data.charts ? data.charts.length : 0}</div>
                            <div class="stat-label">Charts</div>
                        </div>
                    </div>
                </div>
            `;

            // Add charts if available
            if (data.charts && data.charts.length > 0) {
                html += '<div class="charts-grid">';
                data.charts.forEach(chart => {
                    const imageUrl = `${API_BASE_URL}${chart.url}`;
                    html += `
                        <div class="chart-container">
                            <div class="chart-title">${chart.title}</div>
                            <img src="${imageUrl}" alt="${chart.title}" onerror="this.style.display='none'">
                        </div>
                    `;
                });
                html += '</div>';
            }

            // Add insights if available
            if (data.insights && data.insights.length > 0) {
                html += `
                    <div class="insights-section">
                        <h3>üí° Key Insights</h3>
                        <ul class="insights-list">
                `;
                data.insights.forEach(insight => {
                    html += `<li>${insight}</li>`;
                });
                html += '</ul></div>';
            }

            resultsContent.innerHTML = html;
            resultsContent.style.display = 'block';
        }

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('uploadModal');
            if (event.target === modal) {
                closeUploadModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeUploadModal();
                closeWeatherModal();
            }
        });

        // Weather Modal Functions
        function openWeatherModal() {
            document.getElementById('weatherModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeWeatherModal() {
            document.getElementById('weatherModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            resetWeatherForm();
        }

        function resetWeatherForm() {
            document.getElementById('weatherResultsSection').style.display = 'none';
            document.getElementById('weatherLoadingState').style.display = 'block';
            document.getElementById('weatherResultsContent').style.display = 'none';
            loadPopularLocations();
        }

        // Location search functionality
        let searchTimeout;
        let locationSearchResults = [];

        function searchLocations(query) {
            clearTimeout(searchTimeout);
            
            if (!query || query.length < 2) {
                document.getElementById('locationResults').style.display = 'none';
                return;
            }

            searchTimeout = setTimeout(async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/geocoding/search?q=${encodeURIComponent(query)}&limit=5`);
                    const data = await response.json();
                    
                    locationSearchResults = data.results || [];
                    displayLocationResults(locationSearchResults);
                } catch (error) {
                    console.error('Location search error:', error);
                }
            }, 300);
        }

        function displayLocationResults(results) {
            const resultsDiv = document.getElementById('locationResults');
            
            if (results.length === 0) {
                resultsDiv.style.display = 'none';
                return;
            }

            let html = '<div style="border: 1px solid #ddd; border-radius: 4px; max-height: 200px; overflow-y: auto; background: white;">';
            
            results.forEach((location, index) => {
                html += `
                    <div onclick="selectLocation(${index})" 
                         style="padding: 0.75rem; border-bottom: 1px solid #eee; cursor: pointer; display: flex; align-items: center;"
                         onmouseover="this.style.backgroundColor='#f5f5f5'" 
                         onmouseout="this.style.backgroundColor='white'">
                        <span style="margin-right: 0.5rem;">üìç</span>
                        <div>
                            <div style="font-weight: bold;">${location.clean_name || location.name}</div>
                            <div style="font-size: 0.8em; color: #666;">${location.latitude.toFixed(2)}¬∞, ${location.longitude.toFixed(2)}¬∞</div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            resultsDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
        }

        function selectLocation(index) {
            const location = locationSearchResults[index];
            if (location) {
                document.getElementById('latitude').value = location.latitude.toFixed(4);
                document.getElementById('longitude').value = location.longitude.toFixed(4);
                document.getElementById('locationSearch').value = location.clean_name || location.name;
                document.getElementById('locationResults').style.display = 'none';
            }
        }

        function searchAndSelect() {
            const query = document.getElementById('locationSearch').value;
            if (query) {
                searchLocations(query);
            }
        }

        async function loadPopularLocations() {
            try {
                const response = await fetch(`${API_BASE_URL}/geocoding/popular`);
                const data = await response.json();
                
                const popularDiv = document.getElementById('popularLocations');
                let html = '';
                
                data.locations.slice(0, 10).forEach(location => {
                    html += `
                        <button onclick="selectPopularLocation('${location.latitude}', '${location.longitude}', '${location.clean_name}')"
                                style="padding: 0.25rem 0.5rem; margin: 0.125rem; border: 1px solid #2c5aa0; 
                                       background: white; color: #2c5aa0; border-radius: 15px; cursor: pointer; 
                                       font-size: 0.8rem; transition: all 0.2s;"
                                onmouseover="this.style.backgroundColor='#2c5aa0'; this.style.color='white'"
                                onmouseout="this.style.backgroundColor='white'; this.style.color='#2c5aa0'">
                            ${location.clean_name}
                        </button>
                    `;
                });
                
                popularDiv.innerHTML = html;
            } catch (error) {
                console.error('Popular locations error:', error);
            }
        }

        function selectPopularLocation(lat, lon, name) {
            document.getElementById('latitude').value = parseFloat(lat).toFixed(4);
            document.getElementById('longitude').value = parseFloat(lon).toFixed(4);
            document.getElementById('locationSearch').value = name;
            document.getElementById('locationResults').style.display = 'none';
        }

        // Get current location
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        document.getElementById('latitude').value = position.coords.latitude.toFixed(2);
                        document.getElementById('longitude').value = position.coords.longitude.toFixed(2);
                    },
                    function(error) {
                        alert('Unable to get current location: ' + error.message);
                    }
                );
            } else {
                alert('Geolocation is not supported by this browser');
            }
        }

        // Fetch weather data
        async function fetchWeatherData() {
            const latitude = parseFloat(document.getElementById('latitude').value);
            const longitude = parseFloat(document.getElementById('longitude').value);

            if (isNaN(latitude) || isNaN(longitude)) {
                alert('Please enter valid coordinates');
                return;
            }

            if (latitude < -90 || latitude > 90 || longitude < -180 || longitude > 180) {
                alert('Please enter valid coordinates (Latitude: -90 to 90, Longitude: -180 to 180)');
                return;
            }

            const weatherResultsSection = document.getElementById('weatherResultsSection');
            const weatherLoadingState = document.getElementById('weatherLoadingState');
            const weatherResultsContent = document.getElementById('weatherResultsContent');

            // Show loading state
            weatherResultsSection.style.display = 'block';
            weatherLoadingState.style.display = 'block';
            weatherResultsContent.style.display = 'none';

            try {
                const response = await fetch(`${API_BASE_URL}/weather/analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        latitude: latitude,
                        longitude: longitude,
                        hours: 6
                    })
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(errorText || 'Weather fetch failed');
                }

                const data = await response.json();
                displayWeatherResults(data.data);

            } catch (error) {
                console.error('Weather fetch error:', error);
                weatherResultsContent.innerHTML = `
                    <div style="color: red; text-align: center; padding: 2rem;">
                        <h3>‚ùå Error</h3>
                        <p>${error.message}</p>
                    </div>
                `;
                weatherResultsContent.style.display = 'block';
            } finally {
                weatherLoadingState.style.display = 'none';
            }
        }

        // Display weather results
        function displayWeatherResults(data) {
            const weatherResultsContent = document.getElementById('weatherResultsContent');
            
            let html = `
                <div class="results-header">
                    <h3>üå§Ô∏è Weather Analysis Results</h3>
                    <div class="results-stats">
                        <div class="stat-card">
                            <div class="stat-value">${data.data_points || 0}</div>
                            <div class="stat-label">Data Points</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${data.time_range?.hours_covered || 0}h</div>
                            <div class="stat-label">Time Range</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${data.charts ? data.charts.length : 0}</div>
                            <div class="stat-label">Charts</div>
                        </div>
                    </div>
                </div>
            `;

            // Add location info
            if (data.location) {
                html += `
                    <div style="background: white; padding: 1rem; border-radius: 8px; margin: 1rem 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <h4>üìç Location Information</h4>
                        <p><strong>Coordinates:</strong> ${data.location.latitude?.toFixed(2)}¬∞, ${data.location.longitude?.toFixed(2)}¬∞</p>
                        <p><strong>Timezone:</strong> ${data.location.timezone}</p>
                        <p><strong>Elevation:</strong> ${data.location.elevation}m</p>
                    </div>
                `;
            }

            // Add current conditions
            if (data.statistics) {
                html += '<div style="background: white; padding: 1rem; border-radius: 8px; margin: 1rem 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1);"><h4>üå°Ô∏è Current Conditions</h4>';
                
                if (data.statistics.temperature) {
                    html += `<p><strong>Temperature:</strong> ${data.statistics.temperature.current?.toFixed(1)}¬∞C (${data.statistics.temperature.trend})</p>`;
                }
                if (data.statistics.pressure) {
                    html += `<p><strong>Pressure:</strong> ${data.statistics.pressure.current?.toFixed(0)} hPa (${data.statistics.pressure.trend})</p>`;
                }
                if (data.statistics.wind) {
                    html += `<p><strong>Wind:</strong> ${data.statistics.wind.current_speed?.toFixed(1)} km/h</p>`;
                }
                if (data.statistics.rain) {
                    html += `<p><strong>Total Rain:</strong> ${data.statistics.rain.total?.toFixed(1)} mm</p>`;
                }
                
                html += '</div>';
            }

            // Add charts if available
            if (data.charts && data.charts.length > 0) {
                html += '<div class="charts-grid">';
                data.charts.forEach(chart => {
                    const imageUrl = `${API_BASE_URL}${chart.url}`;
                    html += `
                        <div class="chart-container">
                            <div class="chart-title">${chart.title}</div>
                            <img src="${imageUrl}" alt="${chart.title}" onerror="this.style.display='none'">
                        </div>
                    `;
                });
                html += '</div>';
            }

            // Add insights if available
            if (data.insights && data.insights.length > 0) {
                html += `
                    <div class="insights-section">
                        <h3>üí° Weather Insights</h3>
                        <ul class="insights-list">
                `;
                data.insights.forEach(insight => {
                    html += `<li>${insight}</li>`;
                });
                html += '</ul></div>';
            }

            weatherResultsContent.innerHTML = html;
            weatherResultsContent.style.display = 'block';
        }

        // Close weather modal when clicking outside
        window.addEventListener('click', function(event) {
            const weatherModal = document.getElementById('weatherModal');
            if (event.target === weatherModal) {
                closeWeatherModal();
            }
        });
    </script>
</body>
</html>